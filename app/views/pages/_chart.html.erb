<div class="container-sm mt-5">
  <h1 class="text-center fw-bold fs-1 my-4">
    Your financial projections over the next
    <% years, months = @months.count.divmod(12) %>
    <% date_parts = [] %>
    <% date_parts << pluralize(years, 'year') if years > 0 %>
    <% date_parts << pluralize(months, 'month') if months > 0 %>
    <%= date_parts.join(' and ') %>
  </h2>
  <div class="text-center">
    <%
      # 1. Capture the current end date string for comparison
      current_end_str = @end_date.strftime("%Y-%m")

      # 2. Pre-calculate the target dates for each button
      date_10y = (@start_date + 10.years - 1.month).strftime("%Y-%m")
      date_5y  = (@start_date + 5.years - 1.month).strftime("%Y-%m")
      date_3y  = (@start_date + 3.years - 1.month).strftime("%Y-%m")
      date_1y  = (@start_date + 1.year - 1.month).strftime("%Y-%m")

      # 3. Check if Custom is active (Active if NONE of the standard buttons match)
      is_custom_active = ![date_10y, date_5y, date_3y, date_1y].include?(current_end_str)
    %>
    <%= link_to "10 Years",
        dashboard_path(end_date: date_10y, start_date: @start_date),
        class: "btn mx-1 #{current_end_str == date_10y ? 'btn-primary' : 'btn-secondary'}" %>
    <%= link_to "5 Years",
        dashboard_path(end_date: date_5y, start_date: @start_date),
        class: "btn mx-1 #{current_end_str == date_5y ? 'btn-primary' : 'btn-secondary'}" %>
    <%= link_to "3 Years",
        dashboard_path(end_date: date_3y, start_date: @start_date),
        class: "btn mx-1 #{current_end_str == date_3y ? 'btn-primary' : 'btn-secondary'}" %>
    <%= link_to "1 Year",
        dashboard_path(end_date: date_1y, start_date: @start_date),
        class: "btn mx-1 #{current_end_str == date_1y ? 'btn-primary' : 'btn-secondary'}" %>
    <button type="button"
            class="btn mx-1 <%= is_custom_active ? 'btn-primary' : 'btn-secondary' %>"
            data-bs-toggle="modal"
            data-bs-target="#customDateModal">
      Custom
    </button>
  </div>
  <div class="container-sm mt-5">
    <div class="d-flex justify-content-center align-items-center">
      <div>
        <!-- Button to open modal -->
      </div>
    </div>
  </div>
  <div class="mt-5">
    <%= area_chart [
      {
        name: "Savings per Month",
        data: @chart_data_saved,
        color: "#2AFD8B",
        points: true,
        dataset: {
          fill: true,
          order: 1,
          stack: "assets"
        }
      },
      {
        name: "Total Invested Assets",
        data: @chart_data_other,
        color: "#4A90E2",
        points: true,
        dataset: {
          fill: true,
          order: 1,
          stack: "assets"
        }
      },
      {
        name: "Life Event",
        data: @chart_data_event,
        color: "#FF5C5C",
        points: true,
        dataset: {
          showLine: false,        # dots only
          fill: false,
          pointRadius: 8,
          pointHoverRadius: 10,
          pointBorderWidth: 2,
          order: 0,               # draw on top visually
          stack: "markers"        # separate stack so it doesn't affect totals
        }
      }
    ],
    title: "Total Assets (Â¥)",
    legend: "bottom",
    library: {
      scales: {
        xAxes: [{ stacked: true }],
        yAxes: [{ stacked: true }]
      }
    }
    %>
  </div>
</div>
